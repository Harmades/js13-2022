function e(e){return Math.round(e)}function n(e){return Math.cos(e)}function d(e){return Math.sin(e)}function i(e){return document.getElementById(e)}const u=Math.PI;function f(e,n){const d=[];for(let i=0;i<n;i++)d.push(e());return d}const t={debug:!1,width:960,height:640,playerSpeedX:300,playerSpeedY:300,playerWidth:50,playerHeight:50,playerBulletSpeedX:800,enemyBulletSpeedX:200,enemyBulletSpeedY:50,enemyShootFrequency:1,enemyBulletPoolSize:1e3,bulletWidth:5,bulletHeight:5,enemyWidth:50,enemyHeight:50,waveEasyTimeMin:4,waveEasyTimeMax:6,waveEasyAmplitudeMin:10,waveEasyAmplitudeMax:50,waveEasyFrequencyMin:.1,waveEasyFrequencyMax:.25,waveEasyRxMin:100,waveEasyRxMax:200,waveEasyRyMin:100,waveEasyRyMax:200,waveEasySyMin:0,waveEasySyMax:590,waveMediumTimeMin:4,waveMediumTimeMax:6,waveMediumAmplitudeMin:10,waveMediumAmplitudeMax:50,waveMediumFrequencyMin:.1,waveMediumFrequencyMax:.25,waveMediumRxMin:100,waveMediumRxMax:200,waveMediumRyMin:100,waveMediumRyMax:200,waveMediumSyMin:0,waveMediumSyMax:590,waveHardTimeMin:4,waveHardTimeMax:6,waveHardAmplitudeMin:10,waveHardAmplitudeMax:50,waveHardFrequencyMin:.1,waveHardFrequencyMax:.25,waveHardRxMin:100,waveHardRxMax:200,waveHardRyMin:100,waveHardRyMax:200,waveHardSyMin:0,waveHardSyMax:590,engineTimeResolution:1,epsilon:.1,delta:.001};function a(e,n,d=null){const u=null==d?(f="canvas",document.createElement(f)):i(d);var f;u.width=e,u.height=n;return u.getContext("2d")}function r({canvas:n},{x:d,y:i,w:u,h:f},t="#FF0000"){n&&(n.fillStyle=t),n.fillRect(e(d),e(i),u,f)}function l(){return{x:0,y:0,w:t.bulletWidth,h:t.bulletHeight,dx:0,dy:0,isActive:!1}}function o(e){e.isActive&&(e.x+=e.dx*t.delta,e.y+=e.dy*t.delta)}function y(e,n){n.isActive&&r(e,n)}function c(e,n,d){e.x=n.x,e.y=n.y,e.dx=d.x,e.dy=d.y,e.isActive=!0}function s(e){e.isActive=!1,e.dx=0,e.dy=0,e.x=0,e.y=0}function M(...e){return e[Math.floor(Math.random()*e.length)]}function h(e,n){return Math.random()*(n-e)+e}function m(e,n){return e=Math.ceil(e),n=Math.floor(n),Math.floor(Math.random()*(n-e)+e)}function x(e,n){return{x:e,y:n}}function w(e,n){return x(e.x+n.x,e.y+n.y)}let v;var p;let g;var S;let H;var E;function R(e,n,d,i,u,a,r,o,y=BulletPatternSingle){return{x:t.width,y:e,sy:e,dx:0,dy:0,w:t.enemyWidth,h:t.enemyHeight,pattern:n,time:i,color:d,dead:!1,amplitude:u,frequency:a,rx:r,ry:o,elapsedTime:0,shootElapsedTime:0,distance:0,bullets:f((()=>l()),50),bulletPattern:y}}function T(e){for(let n of e.bullets)o(n);if(e.dead)return;const i=e.frequency,f=e.amplitude,a=(t.width+t.enemyWidth)/e.time;if(e.elapsedTime+=t.delta,e.shootElapsedTime+=t.delta,e.pattern==g.Circular&&(e.dx=2*u*i*f*n(2*u*i*e.elapsedTime)-a,e.dy=2*u*i*f*d(2*u*i*e.elapsedTime)),e.pattern==g.Rectangular){const n=e.target;null==e.direction&&(e.direction=v.Left,e.target=h(50,150)),e.direction==v.Left&&(e.distance>=n&&(e.direction=M(v.Up,v.Down),e.distance=0,e.target=h(50,150)),e.dx=-a,e.dy=0,e.distance+=-e.dx*t.delta),e.direction,v.Right,e.direction==v.Up&&(e.distance>=n&&(e.direction=v.Left,e.target=h(50,150),e.distance=0),e.dy=-a/2,e.dx=0,e.distance+=-e.dy*t.delta),e.direction==v.Down&&(e.distance>=n&&(e.direction=v.Left,e.target=h(50,150),e.distance=0),e.dy=a/2,e.dx=0,e.distance+=e.dy*t.delta)}if(e.pattern==g.Triangular&&(e.y>=e.sy+f&&(e.dy=-4*f*i),(0==e.dy||e.y<=e.sy-f)&&(e.dy=4*f*i),e.dx=-a),e.pattern==g.Straight&&(e.dx=-a),e.x+=e.dx*t.delta,e.y+=e.dy*t.delta,e.shootElapsedTime>=1/t.enemyShootFrequency){e.shootElapsedTime=0;let n=e.bullets.find((e=>!e.isActive));if(null==n)return;if(e.bulletPattern!=H.Single&&e.bulletPattern!=H.Triple||(c(n,w(e,x(0,t.enemyHeight/2)),x(-a-t.enemyBulletSpeedX,0)),n=e.bullets.find((e=>!e.isActive))),e.bulletPattern==H.Double||e.bulletPattern==H.Triple){if(null==n)return;if(c(n,w(e,x(0,t.enemyHeight/4)),x(-a-t.enemyBulletSpeedX,-t.enemyBulletSpeedY)),n=e.bullets.find((e=>!e.isActive)),null==n)return;c(n,w(e,x(0,3*t.enemyHeight/4)),x(-a-t.enemyBulletSpeedX,+t.enemyBulletSpeedY))}}}function b(e,n){for(let d of n.bullets)y(e,d);n.dead||r(e,n,n.color)}let A;var q;function F(e){const n=[];if(e==A.Easy){const d=m(3,6);for(let i=0;i<d;i++)n.push(B(e))}if(e==A.Medium){const d=m(5,10);for(let i=0;i<d;i++)n.push(B(e))}if(e==A.Hard){const d=m(9,17);for(let i=0;i<d;i++)n.push(B(e))}return{difficulty:e,enemies:n}}function B(e){const n=`#${Math.floor(16777215*Math.random()).toString(16)}`;if(e==A.Easy){const e=M(g.Straight,g.Triangular),d=h(t.waveEasyAmplitudeMin,t.waveEasyAmplitudeMax),i=h(t.waveEasyFrequencyMin,t.waveEasyFrequencyMax),u=h(t.waveEasyRxMin,t.waveEasyRxMax),f=h(t.waveEasyRyMin,t.waveEasyRyMax);return R(h(t.waveEasySyMin,t.waveEasySyMax),e,n,h(t.waveEasyTimeMin,t.waveEasyTimeMax),d,i,u,f,m(H.Single,H.Double+1))}if(e==A.Medium){const e=M(g.Straight,g.Triangular,g.Rectangular),d=h(t.waveMediumAmplitudeMin,t.waveMediumAmplitudeMax),i=h(t.waveMediumFrequencyMin,t.waveMediumFrequencyMax),u=h(t.waveMediumRxMin,t.waveMediumRxMax),f=h(t.waveMediumRyMin,t.waveMediumRyMax);return R(h(t.waveMediumSyMin,t.waveMediumSyMax),e,n,h(t.waveMediumTimeMin,t.waveMediumTimeMax),d,i,u,f,m(H.Single,H.Triple+1))}if(e==A.Hard){const e=M(g.Triangular,g.Rectangular,g.Circular),d=h(t.waveHardAmplitudeMin,t.waveHardAmplitudeMax),i=h(t.waveHardFrequencyMin,t.waveHardFrequencyMax),u=h(t.waveHardRxMin,t.waveHardRxMax),f=h(t.waveHardRyMin,t.waveHardRyMax);return R(h(t.waveHardSyMin,t.waveHardSyMax),e,n,h(t.waveHardTimeMin,t.waveHardTimeMax),d,i,u,f,m(H.Double,H.Triple+1))}throw new Error}(p=v||(v={}))[p.Up=0]="Up",p[p.Left=1]="Left",p[p.Right=2]="Right",p[p.Down=3]="Down",(S=g||(g={}))[S.Straight=0]="Straight",S[S.Triangular=1]="Triangular",S[S.Circular=2]="Circular",S[S.Rectangular=3]="Rectangular",(E=H||(H={}))[E.Single=0]="Single",E[E.Double=1]="Double",E[E.Triple=2]="Triple",(q=A||(A={}))[q.Easy=0]="Easy",q[q.Medium=1]="Medium",q[q.Hard=2]="Hard";let C=0;function W(e){e.entities=F(A.Easy).enemies,e.deadCount=0,C=0}function D(e){W(e)}function P(e,n){e.dead=!0,n.deadCount++}const X={up:!1,down:!1,left:!1,right:!1,space:!1,shift:!1};function L(e){let n=!0;return()=>X[e]&&n?(n=!1,!0):(X[e]||(n=!0),!1)}onkeydown=onkeyup=e=>function(e,n){38!=e&&90!=e&&87!=e||(X.up=n);39!=e&&68!=e||(X.right=n);40!=e&&83!=e||(X.down=n);37!=e&&65!=e&&81!=e||(X.left=n);16==e&&(X.shift=n);32==e&&(X.space=n)}(e.keyCode,null!=e.type[5]);let Y,I,U=null,k=(...e)=>{let n=U.createBufferSource(),d=U.createBuffer(e.length,e[0].length,j);return e.map(((e,n)=>d.getChannelData(n).set(e))),n.buffer=d,n.connect(U.destination),n.start(),n},z=(e=1,n=.05,d=220,i=0,u=0,f=.1,t=0,a=1,r=0,l=0,o=0,y=0,c=0,s=0,M=0,h=0,m=0,x=1,w=0,v=0)=>{let p,g,S=2*Math.PI,H=r*=500*S/j**2,E=(0<M?1:-1)*S/4,R=d*=(1+2*n*Math.random()-n)*S/j,T=[],b=0,A=0,q=0,F=1,B=0,C=0,W=0;for(l*=500*S/j**3,M*=S/j,o*=S/j,y*=j,c=j*c|0,g=(i=99+j*i)+(w*=j)+(u*=j)+(f*=j)+(m*=j)|0;q<g;T[q++]=W)++C%(100*h|0)||(W=t?1<t?2<t?3<t?Math.sin((b%S)**3):Math.max(Math.min(Math.tan(b),1),-1):1-(2*b/S%2+2)%2:1-4*Math.abs(Math.round(b/S)-b/S):Math.sin(b),W=(c?1-v+v*Math.sin(2*Math.PI*q/c):1)*(0<W?1:-1)*Math.abs(W)**a*e*$*(q<i?q/i:q<i+w?1-(q-i)/w*(1-x):q<i+w+u?x:q<g-m?(g-q-m)/f*x:0),W=m?W/2+(m>q?0:(q<g-m?1:(g-q)/m)*T[q-m|0]/2):W),p=(d+=r+=l)*Math.sin(A*M-E),b+=p-p*s*(1-1e9*(Math.sin(q)+1)%2),A+=p-p*s*(1-1e9*(Math.sin(q)**2+1)%2),F&&++F>y&&(d+=o,R+=o,F=0),!c||++B%c||(d=R,r=H,F=F||1);return T},$=.3,j=44100,G=[[[.5,0,196,.05,.5,.6,1],[.8,undefined,24.5,.2,.3,.7,undefined,.5,undefined,undefined,5,undefined,.1,undefined,undefined,undefined,undefined,.8,undefined,.2],[2,0,196,.02,.1,.4,1],[,0,49,undefined,undefined,.2,3,5]],[[[,-1,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,1,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,12,undefined,undefined,undefined,undefined,undefined,undefined,undefined,17,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,undefined,3,undefined,undefined,undefined,undefined,undefined,undefined,undefined,5,undefined,undefined,undefined,undefined,undefined,undefined,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[2,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,15,15,undefined,13,undefined,10,undefined]],[[,-1,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,1,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,12,undefined,undefined,undefined,undefined,undefined,undefined,undefined,17,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,undefined,3,undefined,undefined,undefined,undefined,undefined,undefined,undefined,5,undefined,undefined,undefined,undefined,undefined,undefined,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[2,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,3,undefined,3,undefined,10,undefined,undefined,undefined,8,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,15,15,undefined,13,undefined,10,undefined],[3,undefined,8,undefined,undefined,undefined,8,undefined,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,1,undefined,3,undefined,undefined,15,15,undefined,13,undefined,10,undefined]],[[,-1,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,1,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,12,undefined,undefined,undefined,undefined,undefined,undefined,undefined,17,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,undefined,3,undefined,undefined,undefined,undefined,undefined,undefined,undefined,5,undefined,undefined,undefined,undefined,undefined,undefined,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[2,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,3,undefined,3,undefined,10,undefined,undefined,undefined,8,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,15,15,undefined,13,undefined,10,undefined],[3,undefined,8,undefined,undefined,undefined,8,undefined,10,undefined,undefined,undefined,1,3,undefined,undefined,8,undefined,1,3,undefined,undefined,1,undefined,3,undefined,undefined,15,15,undefined,13,undefined,10,undefined]]],[0,1,2,1,2],110,undefined];function J(){U=new window.AudioContext,Y=((e,n,d,i=125)=>{let u,f,t,a,r,l,o,y,c,s,M,h,m,x,w,v=0,p=[],g=[],S=[],H=0,E=0,R=1,T={},b=j/i*60>>2;for(;R;H++)p=[R=y=M=m=0],d.map(((i,M)=>{for(o=n[i][H]||[0,0,0],R|=!!n[i][H],w=m+(n[i][0].length-2-!y)*b,x=M==d.length-1,f=2,a=m;f<o.length+x;y=++f){for(r=o[f],c=f==o.length+x-1&&x||s!=(o[0]||0)|r|0,t=0;t<b&&y;t++>b-99&&c&&(h+=(h<1)/99))l=(1-h)*p[v++]/2||0,g[a]=(g[a]||0)-l*E+l,S[a]=(S[a++]||0)+l*E+l;r&&(h=r%1,E=o[1]||0,(r|=0)&&(p=T[[s=o[v=0]||0,r]]=T[[s,r]]||(u=[...e[s]],u[2]*=2**((r-12)/12),r>0?z(...u):[])))}m=w}));return[g,S]})(...G)}const K=L("space"),N=L("shift");let O=x(t.playerWidth,t.playerHeight/2),Q=!1,V=!1;function Z(e){let n=0,d=0;X.left&&(n+=-t.playerSpeedX),X.right&&(n+=t.playerSpeedX),X.up&&(d+=-t.playerSpeedY),X.down&&(d+=t.playerSpeedY),K()&&function(e){let n=e.bullets.find((e=>!e.isActive));null!=n&&c(n,w(e,O),x(t.playerBulletSpeedX,0))}(e),e.dx=n,e.dy=d,V||(J(),V=!0),V&&N()&&(Q?I.stop():(U?.resume(),I=k(...Y),I.loop=!0),Q=!Q),e.x+=e.dx*t.delta,e.y+=e.dy*t.delta,e.x<=0&&(e.x=0),e.x>=t.width-t.playerWidth&&(e.x=t.width-t.playerWidth),e.y<=0&&(e.y=0),e.y>=t.height-t.playerHeight&&(e.y=t.height-t.playerHeight),function(e){for(let n of e)o(n)}(e.bullets)}function _(e){e.x=t.playerWidth,e.y=t.height/2,e.dx=0,e.dy=0}function ee(e,n){const d=ie(ne(e),ne(n)),i=ie(de(e),de(n));return null==d||null==i?null:{x:d.x,y:i.x,w:d.y-d.x,h:i.y-i.x}}function ne(e){return{x:e.x,y:e.x+e.w}}function de(e){return{x:e.y,y:e.y+e.h}}function ie(e,n){return e.y<=n.x||n.y<=e.x?null:{x:Math.max(e.x,n.x),y:Math.min(e.y,n.y)}}let ue=t.engineTimeResolution,fe=performance.now(),te=fe;const ae={x:t.playerWidth,dx:0,y:t.height/2,dy:0,w:t.playerWidth,h:t.playerHeight,bullets:f((()=>l()),50)},re={entities:F(A.Easy).enemies,deadCount:0},le={canvas:a(t.width,t.height,"gameCanvas")};function oe(){Z(ae),function(e){C+=t.delta,(C>=t.waveEasyTimeMax||e.deadCount==e.entities.length)&&(W(e),C=0);for(let n of e.entities)T(n)}(re),function(e,n){for(let d of function(e){return e.entities.filter((e=>!e.dead))}(n)){for(let i of e.bullets)null!=ee(d,i)&&(s(i),P(d,n));for(let i of d.bullets)null!=ee(e,i)&&(D(n),_(e));null!=ee(e,d)&&(_(e),D(n))}}(ae,re)}!function e(n){window.requestAnimationFrame((n=>e(n)));var d,i=0;n>fe+ue&&(d=(n-fe)/ue,i=Math.floor(d));for(var u=0;u<i;u++)fe+=ue,oe();(function({canvas:e}){e.clearRect(0,0,t.width,t.height)})(le),function(e,n){r(e,n);for(let d of n.bullets)d.isActive&&y(e,d)}(le,ae),function(e,n){for(let d of n.entities)b(e,d)}(le,re),te=n}(0);