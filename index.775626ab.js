function e(e){return Math.round(e)}function n(e){return Math.floor(e)}function d(e,n){return Math.min(e,n)}function u(e,n){return Math.pow(e,n)}function f(e){return document.getElementById(e)}Math.PI;function t(e,n){const d=[];for(let i=0;i<n;i++)d.push(e());return d}const a={debug:!1,width:960,height:640,playerSpeedX:300,playerSpeedY:300,playerWidth:50,playerHeight:50,playerBulletSpeedX:800,playerBulletSpeedY:100,playerBulletsPoolSize:200,enemyWidth:50,enemyHeight:50,enemyBulletSpeedX:150,enemyBulletSpeedY:50,enemyBulletsPoolSize:50,enemyShootFrequency:1,enemyBulletPoolSize:1e3,bossWidth:150,bossHeight:150,bossRxMin:100,bossRxMax:200,bossRyMin:100,bossRyMax:200,bossSpeed:50,bossBigBulletWidth:25,bossBigBulletHeight:25,bossBigBulletExplosionTick:200,bulletWidth:5,bulletHeight:5,waveEasyCount:3,waveEasyTimeMin:4,waveEasyTimeMax:6,waveEasyAmplitudeMin:10,waveEasyAmplitudeMax:50,waveEasyFrequencyMin:.1,waveEasyFrequencyMax:.25,waveEasyRxMin:100,waveEasyRxMax:200,waveEasyRyMin:100,waveEasyRyMax:200,waveEasySyMin:0,waveEasySyMax:590,waveMediumCount:3,waveMediumTimeMin:4,waveMediumTimeMax:6,waveMediumAmplitudeMin:10,waveMediumAmplitudeMax:50,waveMediumFrequencyMin:.1,waveMediumFrequencyMax:.25,waveMediumRxMin:100,waveMediumRxMax:200,waveMediumRyMin:100,waveMediumRyMax:200,waveMediumSyMin:0,waveMediumSyMax:590,waveHardCount:3,waveHardTimeMin:4,waveHardTimeMax:6,waveHardAmplitudeMin:10,waveHardAmplitudeMax:50,waveHardFrequencyMin:.1,waveHardFrequencyMax:.25,waveHardRxMin:100,waveHardRxMax:200,waveHardRyMin:100,waveHardRyMax:200,waveHardSyMin:0,waveHardSyMax:590,engineTimeResolution:1,epsilon:.1,delta:.001};function l(e,n,d=null){const i=null==d?(u="canvas",document.createElement(u)):f(d);var u;i.width=e,i.height=n;return i.getContext("2d")}function r({canvas:n},{x:d,y:i,w:u,h:f},t="#FF0000"){n&&(n.fillStyle=t),n.fillRect(e(d),e(i),u,f)}function o(e,n){return{x:e,y:n}}function s(e,n){return o(e.x+n.x,e.y+n.y)}function y(){return{x:0,y:0,w:a.bulletWidth,h:a.bulletHeight,dx:0,dy:0,isActive:!1,baseW:a.bulletWidth,baseH:a.bulletHeight,maxW:100*a.bulletWidth,maxH:100*a.bulletHeight,dw:0,dh:0,explodeTick:0,bullets:void 0}}function c(e){if(!e.isActive)return;e.x+=e.dx*a.delta;const f=e.h;if(e.w=d(e.w+e.dw,e.maxW),e.h=d(e.h+e.dh,e.maxH),e.y+=e.dy*a.delta-(e.h-f)/2,0!=e.explodeTick&&(e.explodeTick-=1,0==e.explodeTick)){if(null==e.bullets)return;const d=e.dx/2;for(i=0;i<4;i++){let f=e.bullets.bullets.find((e=>!e.isActive));if(null==f)return;M(f,e,o(u(-1,i)*d,u(-1,n(i/2))*d))}x(e)}}function h(e,n){n.isActive&&r(e,n)}function M(e,n,d){e.x=n.x,e.y=n.y,e.dx=d.x,e.dy=d.y,e.isActive=!0}function x(e){e.isActive=!1,e.dx=0,e.dy=0,e.x=0,e.y=0,e.w=e.baseW,e.h=e.baseH,e.dw=0,e.dh=0}let w;var p;function m(...e){return e[Math.floor(Math.random()*e.length)]}function v(e,n){return Math.random()*(n-e)+e}function g(e,n){return e=Math.ceil(e),n=Math.floor(n)+1,Math.floor(Math.random()*(n-e)+e)}function b(){return Math.floor(16777215*Math.random()).toString(16)}let S;var H;function R(e,n,d){return{bullets:t((()=>y()),e),baseSpeedX:n,baseSpeedY:d}}function E(e,n,d,u){if(u<S.ConicEnd)for(i=0;i<=u;i++){let f=e.bullets.find((e=>!e.isActive));if(null==f)return;M(f,d,o(n,e.baseSpeedY*(2*i-u)))}if(u==S.Straight){let i=e.bullets.find((e=>!e.isActive));if(null==i)return;i.dh=.1,M(i,d,o(n,0))}if(u==S.Explosion){let i=e.bullets.find((e=>!e.isActive));if(null==i)return;i.w=a.bossBigBulletWidth,i.h=a.bossBigBulletHeight,i.bullets=e,i.explodeTick=a.bossBigBulletExplosionTick,M(i,s(d,o(a.bossBigBulletWidth,-a.bossBigBulletHeight/2)),o(n,0))}}let B,T;function A(e,n,d,i,u,f,t,l,r=S.Single){return{x:a.width,y:e,sy:e,dx:0,dy:0,w:a.enemyWidth,h:a.enemyHeight,pattern:n,time:i,color:d,dead:!1,amplitude:u,frequency:f,rx:t,ry:l,elapsedTime:0,shootElapsedTime:0,distance:0,direction:w.Left,bullets:R(a.enemyBulletsPoolSize,a.enemyBulletSpeedX,a.enemyBulletSpeedY),bulletsPattern:r}}var W;function C(e){const n=[];if(e==T.Easy){const d=g(3,6);for(let i=0;i<d;i++)n.push(F(e))}if(e==T.Medium){const d=g(5,10);for(let i=0;i<d;i++)n.push(F(e))}if(e==T.Hard){const d=g(9,17);for(let i=0;i<d;i++)n.push(F(e))}return{difficulty:e,enemies:n}}function F(e){const n=`#${b()}`;if(e==T.Easy){const e=m(B.Straight,B.Triangular),d=v(a.waveEasyAmplitudeMin,a.waveEasyAmplitudeMax),i=v(a.waveEasyFrequencyMin,a.waveEasyFrequencyMax),u=v(a.waveEasyRxMin,a.waveEasyRxMax),f=v(a.waveEasyRyMin,a.waveEasyRyMax);return A(v(a.waveEasySyMin,a.waveEasySyMax),e,n,v(a.waveEasyTimeMin,a.waveEasyTimeMax),d,i,u,f,g(S.Single,S.Double))}if(e==T.Medium){const e=m(B.Straight,B.Triangular,B.Rectangular),d=v(a.waveMediumAmplitudeMin,a.waveMediumAmplitudeMax),i=v(a.waveMediumFrequencyMin,a.waveMediumFrequencyMax),u=v(a.waveMediumRxMin,a.waveMediumRxMax),f=v(a.waveMediumRyMin,a.waveMediumRyMax);return A(v(a.waveMediumSyMin,a.waveMediumSyMax),e,n,v(a.waveMediumTimeMin,a.waveMediumTimeMax),d,i,u,f,g(S.Single,S.Quintuple))}if(e==T.Hard){const e=m(B.Triangular,B.Rectangular,B.Circular),d=v(a.waveHardAmplitudeMin,a.waveHardAmplitudeMax),i=v(a.waveHardFrequencyMin,a.waveHardFrequencyMax),u=v(a.waveHardRxMin,a.waveHardRxMax),f=v(a.waveHardRyMin,a.waveHardRyMax);return A(v(a.waveHardSyMin,a.waveHardSyMax),e,n,v(a.waveHardTimeMin,a.waveHardTimeMax),d,i,u,f,g(S.Double,S.Sixtuple))}throw new Error}(p=w||(w={}))[p.Up=0]="Up",p[p.Left=1]="Left",p[p.Right=2]="Right",p[p.Down=3]="Down",(H=S||(S={}))[H.Single=0]="Single",H[H.Double=1]="Double",H[H.Triple=2]="Triple",H[H.Quadruple=3]="Quadruple",H[H.Quintuple=4]="Quintuple",H[H.Sixtuple=5]="Sixtuple",H[H.ConicEnd=6]="ConicEnd",H[H.Straight=7]="Straight",H[H.Explosion=8]="Explosion",function(e){e[e.Straight=0]="Straight",e[e.Triangular=1]="Triangular",e[e.Circular=2]="Circular",e[e.Rectangular=3]="Rectangular"}(B||(B={})),(W=T||(T={}))[W.Easy=0]="Easy",W[W.Medium=1]="Medium",W[W.Hard=2]="Hard";let q=0,D=1;function P(e){D++;let n=T.Easy;D>3&&D<=6&&(n=T.Medium),D>6&&(n=T.Hard),e.entities=C(n).enemies,e.deadCount=0,q=0}function k(e){D=1,P(e)}function L(e,n){e.dead=!0,n.deadCount++}const X={up:!1,down:!1,left:!1,right:!1,space:!1,shift:!1};function Y(e){let n=!0;return()=>X[e]&&n?(n=!1,!0):(X[e]||(n=!0),!1)}onkeydown=onkeyup=e=>function(e,n){38!=e&&90!=e&&87!=e||(X.up=n);39!=e&&68!=e||(X.right=n);40!=e&&83!=e||(X.down=n);37!=e&&65!=e&&81!=e||(X.left=n);16==e&&(X.shift=n);32==e&&(X.space=n)}(e.keyCode,null!=e.type[5]);let U,z,Q=null,I=(...e)=>{let n=Q.createBufferSource(),d=Q.createBuffer(e.length,e[0].length,G);return e.map(((e,n)=>d.getChannelData(n).set(e))),n.buffer=d,n.connect(Q.destination),n.start(),n},$=(e=1,n=.05,d=220,i=0,u=0,f=.1,t=0,a=1,l=0,r=0,o=0,s=0,y=0,c=0,h=0,M=0,x=0,w=1,p=0,m=0)=>{let v,g,b=2*Math.PI,S=l*=500*b/G**2,H=(0<h?1:-1)*b/4,R=d*=(1+2*n*Math.random()-n)*b/G,E=[],B=0,T=0,A=0,W=1,C=0,F=0,q=0;for(r*=500*b/G**3,h*=b/G,o*=b/G,s*=G,y=G*y|0,g=(i=99+G*i)+(p*=G)+(u*=G)+(f*=G)+(x*=G)|0;A<g;E[A++]=q)++F%(100*M|0)||(q=t?1<t?2<t?3<t?Math.sin((B%b)**3):Math.max(Math.min(Math.tan(B),1),-1):1-(2*B/b%2+2)%2:1-4*Math.abs(Math.round(B/b)-B/b):Math.sin(B),q=(y?1-m+m*Math.sin(2*Math.PI*A/y):1)*(0<q?1:-1)*Math.abs(q)**a*e*j*(A<i?A/i:A<i+p?1-(A-i)/p*(1-w):A<i+p+u?w:A<g-x?(g-A-x)/f*w:0),q=x?q/2+(x>A?0:(A<g-x?1:(g-A)/x)*E[A-x|0]/2):q),v=(d+=l+=r)*Math.sin(T*h-H),B+=v-v*c*(1-1e9*(Math.sin(A)+1)%2),T+=v-v*c*(1-1e9*(Math.sin(A)**2+1)%2),W&&++W>s&&(d+=o,R+=o,W=0),!y||++C%y||(d=R,l=S,W=W||1);return E},j=.3,G=44100,J=[[[.5,0,196,.05,.5,.6,1],[.8,undefined,24.5,.2,.3,.7,undefined,.5,undefined,undefined,5,undefined,.1,undefined,undefined,undefined,undefined,.8,undefined,.2],[2,0,196,.02,.1,.4,1],[,0,49,undefined,undefined,.2,3,5]],[[[,-1,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,1,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,12,undefined,undefined,undefined,undefined,undefined,undefined,undefined,17,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,undefined,3,undefined,undefined,undefined,undefined,undefined,undefined,undefined,5,undefined,undefined,undefined,undefined,undefined,undefined,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[2,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,15,15,undefined,13,undefined,10,undefined]],[[,-1,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,1,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,12,undefined,undefined,undefined,undefined,undefined,undefined,undefined,17,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,undefined,3,undefined,undefined,undefined,undefined,undefined,undefined,undefined,5,undefined,undefined,undefined,undefined,undefined,undefined,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[2,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,3,undefined,3,undefined,10,undefined,undefined,undefined,8,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,15,15,undefined,13,undefined,10,undefined],[3,undefined,8,undefined,undefined,undefined,8,undefined,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,1,undefined,3,undefined,undefined,15,15,undefined,13,undefined,10,undefined]],[[,-1,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,1,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,12,undefined,undefined,undefined,undefined,undefined,undefined,undefined,17,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,undefined,3,undefined,undefined,undefined,undefined,undefined,undefined,undefined,5,undefined,undefined,undefined,undefined,undefined,undefined,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[2,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,3,undefined,3,undefined,10,undefined,undefined,undefined,8,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,15,15,undefined,13,undefined,10,undefined],[3,undefined,8,undefined,undefined,undefined,8,undefined,10,undefined,undefined,undefined,1,3,undefined,undefined,8,undefined,1,3,undefined,undefined,1,undefined,3,undefined,undefined,15,15,undefined,13,undefined,10,undefined]]],[0,1,2,1,2],110,undefined];function K(){Q=new window.AudioContext,U=((e,n,d,i=125)=>{let u,f,t,a,l,r,o,s,y,c,h,M,x,w,p,m=0,v=[],g=[],b=[],S=0,H=0,R=1,E={},B=G/i*60>>2;for(;R;S++)v=[R=s=h=x=0],d.map(((i,h)=>{for(o=n[i][S]||[0,0,0],R|=!!n[i][S],p=x+(n[i][0].length-2-!s)*B,w=h==d.length-1,f=2,a=x;f<o.length+w;s=++f){for(l=o[f],y=f==o.length+w-1&&w||c!=(o[0]||0)|l|0,t=0;t<B&&s;t++>B-99&&y&&(M+=(M<1)/99))r=(1-M)*v[m++]/2||0,g[a]=(g[a]||0)-r*H+r,b[a]=(b[a++]||0)+r*H+r;l&&(M=l%1,H=o[1]||0,(l|=0)&&(v=E[[c=o[m=0]||0,l]]=E[[c,l]]||(u=[...e[c]],u[2]*=2**((l-12)/12),l>0?$(...u):[])))}x=p}));return[g,b]})(...J)}const N=Y("space"),O=Y("shift");o(a.playerWidth,a.playerHeight/2);let V=!1,Z=!1;function _(e){let n=0,d=0;X.left&&(n+=-a.playerSpeedX),X.right&&(n+=a.playerSpeedX),X.up&&(d+=-a.playerSpeedY),X.down&&(d+=a.playerSpeedY),N()&&function(e){null!=e.bullets.bullets.find((e=>!e.isActive))&&E(e.bullets,e.dx+a.playerBulletSpeedX,s(e,o(a.playerWidth,a.playerHeight/2)),e.bulletsPattern)}(e),e.dx=n,e.dy=d,Z||(K(),Z=!0),Z&&O()&&(V?z.stop():(Q?.resume(),z=I(...U),z.loop=!0),V=!V),e.x+=e.dx*a.delta,e.y+=e.dy*a.delta,e.x<=0&&(e.x=0),e.x>=a.width-a.playerWidth&&(e.x=a.width-a.playerWidth),e.y<=0&&(e.y=0),e.y>=a.height-a.playerHeight&&(e.y=a.height-a.playerHeight),function(e){for(let n of e.bullets)c(n)}(e.bullets)}function ee(e){e.x=a.playerWidth,e.y=a.height/2,e.dx=0,e.dy=0}function ne(e,n){const d=ue(de(e),de(n)),i=ue(ie(e),ie(n));return null==d||null==i?null:{x:d.x,y:i.x,w:d.y-d.x,h:i.y-i.x}}function de(e){return{x:e.x,y:e.x+e.w}}function ie(e){return{x:e.y,y:e.y+e.h}}function ue(e,n){return e.y<=n.x||n.y<=e.x?null:{x:Math.max(e.x,n.x),y:Math.min(e.y,n.y)}}let fe=a.engineTimeResolution,te=performance.now(),ae=te;const le={x:a.playerWidth,dx:0,y:a.height/2,dy:0,w:a.playerWidth,h:a.playerHeight,bullets:R(a.playerBulletsPoolSize,a.playerBulletSpeedX,a.playerBulletSpeedY),bulletsPattern:S.Single},re=function(){const e=`#${b()}`;return{x:.75*a.width,y:.5*a.height,w:a.bossWidth,h:a.bossHeight,dx:0,dy:0,distance:0,color:e,direction:w.Left,bullets:t((()=>y()),100),rx:v(a.bossRxMin,a.bossRxMax),ry:v(a.bossRyMin,a.bossRyMax)}}(),oe={entities:C(T.Easy).enemies,deadCount:0},se={canvas:l(a.width,a.height,"gameCanvas")};function ye(){_(le),function(e){for(let n of e.bullets)c(n);const n=a.bossSpeed;null==e.direction&&(e.direction=w.Left),e.direction==w.Left&&(e.distance>=e.rx&&(e.direction=m(w.Up,w.Down,w.Right),e.distance=0),e.dx=-n,e.dy=0,e.distance+=-e.dx*a.delta),e.direction==w.Right&&(e.distance>=e.rx&&(e.direction=m(w.Up,w.Down,w.Left),e.distance=0),e.dx=n,e.dy=0,e.distance+=e.dx*a.delta),e.direction==w.Up&&(e.distance>=e.ry&&(e.direction=m(w.Right,w.Down,w.Left),e.distance=0),e.dy=-n/2,e.dx=0,e.distance+=-e.dy*a.delta),e.direction==w.Down&&(e.distance>=e.ry&&(e.direction=m(w.Right,w.Up,w.Left),e.distance=0),e.dy=n/2,e.dx=0,e.distance+=e.dy*a.delta),e.x+=e.dx*a.delta,e.y+=e.dy*a.delta}(re),function(e,n){for(let d of function(e){return e.entities.filter((e=>!e.dead))}(n)){for(let i of e.bullets.bullets)null!=ne(d,i)&&(x(i),L(d,n));for(let i of d.bullets.bullets)null!=ne(e,i)&&(k(n),ee(e));null!=ne(e,d)&&(ee(e),k(n))}}(le,oe)}!function e(d){window.requestAnimationFrame((n=>e(n)));var i=0;d>te+fe&&(i=n((d-te)/fe));for(var u=0;u<i;u++)te+=fe,ye();(function({canvas:e}){e.clearRect(0,0,a.width,a.height)})(se),function(e,n){r(e,n);for(let d of n.bullets.bullets)d.isActive&&h(e,d)}(se,le),function(e,n){for(let d of n.bullets)h(e,d);r(e,n,n.color)}(se,re),ae=d}(0);