function e(e){return Math.round(e)}function n(e){return Math.floor(e)}function d(e){return Math.ceil(e)}function u(e,n){return Math.min(e,n)}function t(e,n){return Math.pow(e,n)}function f(e){return document.getElementById(e)}Math.PI;const a={debug:!1,width:960,height:640,playerSpeedX:300,playerSpeedY:300,playerWidth:50,playerHeight:50,playerBulletSpeedX:800,playerBulletSpeedY:100,playerBulletsPoolSize:200,enemyWidth:50,enemyHeight:50,enemyBulletSpeedX:150,enemyBulletSpeedY:50,enemyBulletsPoolSize:50,enemyShootFrequency:1,enemyBulletPoolSize:1e3,bossWidth:150,bossHeight:150,bossRxMin:100,bossRxMax:200,bossRyMin:100,bossRyMax:200,bossSpeed:100,bossBulletSpeedX:200,bossBulletSpeedY:25,bossBulletsPoolSize:200,bossBigBulletWidth:25,bossBigBulletHeight:25,bossBigBulletExplosionTick:200,bossPatternFrequency:5,bulletWidth:5,bulletHeight:5,waveEasyCount:3,waveEasyTimeMin:4,waveEasyTimeMax:6,waveEasyAmplitudeMin:10,waveEasyAmplitudeMax:50,waveEasyFrequencyMin:.1,waveEasyFrequencyMax:.25,waveEasyRxMin:100,waveEasyRxMax:200,waveEasyRyMin:100,waveEasyRyMax:200,waveEasySyMin:0,waveEasySyMax:590,waveMediumCount:3,waveMediumTimeMin:4,waveMediumTimeMax:6,waveMediumAmplitudeMin:10,waveMediumAmplitudeMax:50,waveMediumFrequencyMin:.1,waveMediumFrequencyMax:.25,waveMediumRxMin:100,waveMediumRxMax:200,waveMediumRyMin:100,waveMediumRyMax:200,waveMediumSyMin:0,waveMediumSyMax:590,waveHardCount:3,waveHardTimeMin:4,waveHardTimeMax:6,waveHardAmplitudeMin:10,waveHardAmplitudeMax:50,waveHardFrequencyMin:.1,waveHardFrequencyMax:.25,waveHardRxMin:100,waveHardRxMax:200,waveHardRyMin:100,waveHardRyMax:200,waveHardSyMin:0,waveHardSyMax:590,engineTimeResolution:1,epsilon:.1,delta:.001};function r(e,n,d=null){const i=null==d?(u="canvas",document.createElement(u)):f(d);var u;i.width=e,i.height=n;return i.getContext("2d")}function l({canvas:n},{x:d,y:i,w:u,h:t},f="#FF0000"){n&&(n.fillStyle=f),n.fillRect(e(d),e(i),u,t)}function o(e,n){return{x:e,y:n}}function s(e,n){return o(e.x+n.x,e.y+n.y)}function h(e){if(!e.isActive)return;e.x+=e.dx*a.delta;const d=e.h;if(e.w=u(e.w+e.dw,e.maxW),e.h=u(e.h+e.dh,e.maxH),e.y+=e.dy*a.delta-(e.h-d)/2,0!=e.explodeTick&&(e.explodeTick-=1,0==e.explodeTick)){if(null==e.bullets)return;const d=e.dx/2;for(i=0;i<4;i++){let u=e.bullets.bullets.find((e=>!e.isActive));if(null==u)return;c(u,e,o(t(-1,i)*d,t(-1,n(i/2))*d))}x(e)}}function y(e,n){n.isActive&&l(e,n)}function c(e,n,d){e.x=n.x,e.y=n.y,e.dx=d.x,e.dy=d.y,e.isActive=!0}function x(e){e.isActive=!1,e.dx=0,e.dy=0,e.x=0,e.y=0,e.w=e.baseW,e.h=e.baseH,e.dw=0,e.dh=0}function p(e,n){const d=[];for(let i=0;i<n;i++)d.push(e());return d}let M;var w;function m(e,n,d){return{bullets:p((()=>({x:0,y:0,w:a.bulletWidth,h:a.bulletHeight,dx:0,dy:0,isActive:!1,baseW:a.bulletWidth,baseH:a.bulletHeight,maxW:100*a.bulletWidth,maxH:100*a.bulletHeight,dw:0,dh:0,explodeTick:0,bullets:void 0})),e),baseSpeedX:n,baseSpeedY:d}}function v(e,n,d,u){if(u<M.ConicEnd)for(i=0;i<=u;i++){let t=e.bullets.find((e=>!e.isActive));if(null==t)return;c(t,d,o(n,e.baseSpeedY*(2*i-u)))}if(u==M.Straight){let i=e.bullets.find((e=>!e.isActive));if(null==i)return;i.dh=.1,c(i,d,o(n,0))}if(u==M.Explosion){let i=e.bullets.find((e=>!e.isActive));if(null==i)return;i.w=a.bossBigBulletWidth,i.h=a.bossBigBulletHeight,i.bullets=e,i.explodeTick=a.bossBigBulletExplosionTick,c(i,s(d,o(a.bossBigBulletWidth,-a.bossBigBulletHeight/2)),o(n,0))}}function g(e){for(let n of e.bullets)h(n)}function b(e,n){for(let d of n.bullets)y(e,d)}function S(...e){return e[Math.floor(Math.random()*e.length)]}function H(e,n){return Math.random()*(n-e)+e}function E(e,n){return e=Math.ceil(e),n=Math.floor(n)+1,Math.floor(Math.random()*(n-e)+e)}function R(){return Math.floor(16777215*Math.random()).toString(16)}(w=M||(M={}))[w.Single=0]="Single",w[w.Double=1]="Double",w[w.Triple=2]="Triple",w[w.Quadruple=3]="Quadruple",w[w.Quintuple=4]="Quintuple",w[w.Sixtuple=5]="Sixtuple",w[w.ConicEnd=6]="ConicEnd",w[w.Straight=7]="Straight",w[w.Explosion=8]="Explosion";const P={duration:10,tx:.9*a.width-a.bossWidth,ty:a.height-a.bossHeight,dx:-50,dy:-20,shootPattern:[M.Sixtuple,M.Quintuple,M.Triple],shootCount:[2,2,2],shootFrequency:[4,3,2],shootSpeed:[35,40,55],repeat:3,resetPosOnRepeat:!1},B={duration:10,tx:.8*a.width-a.bossWidth,ty:a.bossHeight,dx:0,dy:20,shootPattern:[M.Straight,M.Straight,M.Straight],shootCount:[1,1,1],shootFrequency:[.5,1,.5],shootSpeed:[40,20,50],repeat:3,resetPosOnRepeat:!0};let T;var C;let W,A;function F(e,n,d,i,u,t,f,r,l=M.Single){return{x:a.width,y:e,sy:e,dx:0,dy:0,w:a.enemyWidth,h:a.enemyHeight,pattern:n,time:i,color:d,dead:!1,amplitude:u,frequency:t,rx:f,ry:r,elapsedTime:0,shootElapsedTime:0,distance:0,direction:T.Left,bullets:m(a.enemyBulletsPoolSize,a.enemyBulletSpeedX,a.enemyBulletSpeedY),bulletsPattern:l}}var q;function I(e){const n=[];if(e==A.Easy){const d=E(3,6);for(let i=0;i<d;i++)n.push(X(e))}if(e==A.Medium){const d=E(5,10);for(let i=0;i<d;i++)n.push(X(e))}if(e==A.Hard){const d=E(9,17);for(let i=0;i<d;i++)n.push(X(e))}return{difficulty:e,enemies:n}}function X(e){const n=`#${R()}`;if(e==A.Easy){const e=S(W.Straight,W.Triangular),d=H(a.waveEasyAmplitudeMin,a.waveEasyAmplitudeMax),i=H(a.waveEasyFrequencyMin,a.waveEasyFrequencyMax),u=H(a.waveEasyRxMin,a.waveEasyRxMax),t=H(a.waveEasyRyMin,a.waveEasyRyMax);return F(H(a.waveEasySyMin,a.waveEasySyMax),e,n,H(a.waveEasyTimeMin,a.waveEasyTimeMax),d,i,u,t,E(M.Single,M.Double))}if(e==A.Medium){const e=S(W.Straight,W.Triangular,W.Rectangular),d=H(a.waveMediumAmplitudeMin,a.waveMediumAmplitudeMax),i=H(a.waveMediumFrequencyMin,a.waveMediumFrequencyMax),u=H(a.waveMediumRxMin,a.waveMediumRxMax),t=H(a.waveMediumRyMin,a.waveMediumRyMax);return F(H(a.waveMediumSyMin,a.waveMediumSyMax),e,n,H(a.waveMediumTimeMin,a.waveMediumTimeMax),d,i,u,t,E(M.Single,M.Quintuple))}if(e==A.Hard){const e=S(W.Triangular,W.Rectangular,W.Circular),d=H(a.waveHardAmplitudeMin,a.waveHardAmplitudeMax),i=H(a.waveHardFrequencyMin,a.waveHardFrequencyMax),u=H(a.waveHardRxMin,a.waveHardRxMax),t=H(a.waveHardRyMin,a.waveHardRyMax);return F(H(a.waveHardSyMin,a.waveHardSyMax),e,n,H(a.waveHardTimeMin,a.waveHardTimeMax),d,i,u,t,E(M.Double,M.Sixtuple))}throw new Error}(C=T||(T={}))[C.Up=0]="Up",C[C.Left=1]="Left",C[C.Right=2]="Right",C[C.Down=3]="Down",function(e){e[e.Straight=0]="Straight",e[e.Triangular=1]="Triangular",e[e.Circular=2]="Circular",e[e.Rectangular=3]="Rectangular"}(W||(W={})),(q=A||(A={}))[q.Easy=0]="Easy",q[q.Medium=1]="Medium",q[q.Hard=2]="Hard";let Y=0,k=1;function z(e){k++;let n=A.Easy;k>3&&k<=6&&(n=A.Medium),k>6&&(n=A.Hard),e.entities=I(n).enemies,e.deadCount=0,Y=0}function D(e){k=1,z(e)}function Q(e,n){e.dead=!0,n.deadCount++}const L={up:!1,down:!1,left:!1,right:!1,space:!1,shift:!1};function O(e){let n=!0;return()=>L[e]&&n?(n=!1,!0):(L[e]||(n=!0),!1)}onkeydown=onkeyup=e=>function(e,n){38!=e&&90!=e&&87!=e||(L.up=n);39!=e&&68!=e||(L.right=n);40!=e&&83!=e||(L.down=n);37!=e&&65!=e&&81!=e||(L.left=n);16==e&&(L.shift=n);32==e&&(L.space=n)}(e.keyCode,null!=e.type[5]);let U,$,j=null,G=(...e)=>{let n=j.createBufferSource(),d=j.createBuffer(e.length,e[0].length,N);return e.map(((e,n)=>d.getChannelData(n).set(e))),n.buffer=d,n.connect(j.destination),n.start(),n},J=(e=1,n=.05,d=220,i=0,u=0,t=.1,f=0,a=1,r=0,l=0,o=0,s=0,h=0,y=0,c=0,x=0,p=0,M=1,w=0,m=0)=>{let v,g,b=2*Math.PI,S=r*=500*b/N**2,H=(0<c?1:-1)*b/4,E=d*=(1+2*n*Math.random()-n)*b/N,R=[],P=0,B=0,T=0,C=1,W=0,A=0,F=0;for(l*=500*b/N**3,c*=b/N,o*=b/N,s*=N,h=N*h|0,g=(i=99+N*i)+(w*=N)+(u*=N)+(t*=N)+(p*=N)|0;T<g;R[T++]=F)++A%(100*x|0)||(F=f?1<f?2<f?3<f?Math.sin((P%b)**3):Math.max(Math.min(Math.tan(P),1),-1):1-(2*P/b%2+2)%2:1-4*Math.abs(Math.round(P/b)-P/b):Math.sin(P),F=(h?1-m+m*Math.sin(2*Math.PI*T/h):1)*(0<F?1:-1)*Math.abs(F)**a*e*K*(T<i?T/i:T<i+w?1-(T-i)/w*(1-M):T<i+w+u?M:T<g-p?(g-T-p)/t*M:0),F=p?F/2+(p>T?0:(T<g-p?1:(g-T)/p)*R[T-p|0]/2):F),v=(d+=r+=l)*Math.sin(B*c-H),P+=v-v*y*(1-1e9*(Math.sin(T)+1)%2),B+=v-v*y*(1-1e9*(Math.sin(T)**2+1)%2),C&&++C>s&&(d+=o,E+=o,C=0),!h||++W%h||(d=E,r=S,C=C||1);return R},K=.3,N=44100,V=[[[.5,0,196,.05,.5,.6,1],[.8,undefined,24.5,.2,.3,.7,undefined,.5,undefined,undefined,5,undefined,.1,undefined,undefined,undefined,undefined,.8,undefined,.2],[2,0,196,.02,.1,.4,1],[,0,49,undefined,undefined,.2,3,5]],[[[,-1,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,1,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,12,undefined,undefined,undefined,undefined,undefined,undefined,undefined,17,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,undefined,3,undefined,undefined,undefined,undefined,undefined,undefined,undefined,5,undefined,undefined,undefined,undefined,undefined,undefined,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[2,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,15,15,undefined,13,undefined,10,undefined]],[[,-1,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,1,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,12,undefined,undefined,undefined,undefined,undefined,undefined,undefined,17,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,undefined,3,undefined,undefined,undefined,undefined,undefined,undefined,undefined,5,undefined,undefined,undefined,undefined,undefined,undefined,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[2,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,3,undefined,3,undefined,10,undefined,undefined,undefined,8,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,15,15,undefined,13,undefined,10,undefined],[3,undefined,8,undefined,undefined,undefined,8,undefined,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,1,undefined,3,undefined,undefined,15,15,undefined,13,undefined,10,undefined]],[[,-1,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,1,10,undefined,undefined,undefined,undefined,undefined,undefined,undefined,12,undefined,undefined,undefined,undefined,undefined,undefined,undefined,17,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[,undefined,3,undefined,undefined,undefined,undefined,undefined,undefined,undefined,5,undefined,undefined,undefined,undefined,undefined,undefined,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined],[2,undefined,8,undefined,undefined,undefined,undefined,undefined,undefined,undefined,3,undefined,3,undefined,10,undefined,undefined,undefined,8,undefined,6,undefined,undefined,undefined,undefined,undefined,undefined,15,15,undefined,13,undefined,10,undefined],[3,undefined,8,undefined,undefined,undefined,8,undefined,10,undefined,undefined,undefined,1,3,undefined,undefined,8,undefined,1,3,undefined,undefined,1,undefined,3,undefined,undefined,15,15,undefined,13,undefined,10,undefined]]],[0,1,2,1,2],110,undefined];function Z(){j=new window.AudioContext,U=((e,n,d,i=125)=>{let u,t,f,a,r,l,o,s,h,y,c,x,p,M,w,m=0,v=[],g=[],b=[],S=0,H=0,E=1,R={},P=N/i*60>>2;for(;E;S++)v=[E=s=c=p=0],d.map(((i,c)=>{for(o=n[i][S]||[0,0,0],E|=!!n[i][S],w=p+(n[i][0].length-2-!s)*P,M=c==d.length-1,t=2,a=p;t<o.length+M;s=++t){for(r=o[t],h=t==o.length+M-1&&M||y!=(o[0]||0)|r|0,f=0;f<P&&s;f++>P-99&&h&&(x+=(x<1)/99))l=(1-x)*v[m++]/2||0,g[a]=(g[a]||0)-l*H+l,b[a]=(b[a++]||0)+l*H+l;r&&(x=r%1,H=o[1]||0,(r|=0)&&(v=R[[y=o[m=0]||0,r]]=R[[y,r]]||(u=[...e[y]],u[2]*=2**((r-12)/12),r>0?J(...u):[])))}p=w}));return[g,b]})(...V)}const _=O("space"),ee=O("shift");o(a.playerWidth,a.playerHeight/2);let ne=!1,de=!1;function ie(e){let n=0,d=0;L.left&&(n+=-a.playerSpeedX),L.right&&(n+=a.playerSpeedX),L.up&&(d+=-a.playerSpeedY),L.down&&(d+=a.playerSpeedY),_()&&function(e){null!=e.bullets.bullets.find((e=>!e.isActive))&&v(e.bullets,e.dx+a.playerBulletSpeedX,s(e,o(a.playerWidth,a.playerHeight/2)),e.bulletsPattern)}(e),e.dx=n,e.dy=d,de||(Z(),de=!0),de&&ee()&&(ne?$.stop():(j?.resume(),$=G(...U),$.loop=!0),ne=!ne),e.x+=e.dx*a.delta,e.y+=e.dy*a.delta,e.x<=0&&(e.x=0),e.x>=a.width-a.playerWidth&&(e.x=a.width-a.playerWidth),e.y<=0&&(e.y=0),e.y>=a.height-a.playerHeight&&(e.y=a.height-a.playerHeight),function(e){for(let n of e.bullets)h(n)}(e.bullets)}function ue(e){e.x=a.playerWidth,e.y=a.height/2,e.dx=0,e.dy=0}function te(e,n){const d=re(fe(e),fe(n)),i=re(ae(e),ae(n));return null==d||null==i?null:{x:d.x,y:i.x,w:d.y-d.x,h:i.y-i.x}}function fe(e){return{x:e.x,y:e.x+e.w}}function ae(e){return{x:e.y,y:e.y+e.h}}function re(e,n){return e.y<=n.x||n.y<=e.x?null:{x:Math.max(e.x,n.x),y:Math.min(e.y,n.y)}}let le=a.engineTimeResolution,oe=performance.now(),se=oe;const he={x:a.playerWidth,dx:0,y:a.height/2,dy:0,w:a.playerWidth,h:a.playerHeight,bullets:m(a.playerBulletsPoolSize,a.playerBulletSpeedX,a.playerBulletSpeedY),bulletsPattern:M.Single},ye=function(){const e=`#${R()}`;return{x:.5*a.width-a.bossWidth/2,y:.5*a.height-a.bossHeight/2,w:a.bossWidth,h:a.bossHeight,dx:0,dy:0,color:e,bullets:m(a.bossBulletsPoolSize,a.bossBulletSpeedX,a.bossBulletSpeedY),elapsedTime:0,currentPattern:P,shootElapsedTime:0,shootCount:0,targetReached:!1,patternIndex:0,repeatCount:0}}(),ce={entities:I(A.Easy).enemies,deadCount:0},xe={canvas:r(a.width,a.height,"gameCanvas")};function pe(){ie(he),function(e){g(e.bullets),e.elapsedTime+=a.delta,e.shootElapsedTime+=a.delta;const i=a.bossSpeed;if(e.targetReached?(e.dx=e.currentPattern.dx,e.dy=e.currentPattern.dy):(e.x>e.currentPattern.tx?e.dx=-i:e.x<e.currentPattern.tx&&(e.dx=i),e.y>e.currentPattern.ty?e.dy=-i:e.y<e.currentPattern.ty&&(e.dy=i)),e.x+=e.dx*a.delta,e.y+=e.dy*a.delta,e.targetReached&&(e.shootCount<e.currentPattern.shootCount[e.patternIndex]?e.shootElapsedTime>=1/e.currentPattern.shootFrequency[e.patternIndex]&&(e.shootCount+=1,e.shootElapsedTime=0,null!=e.currentPattern.shootPattern[e.patternIndex]&&v(e.bullets,e.dx-e.currentPattern.shootSpeed[e.patternIndex],s(e,o(0,a.bossHeight/2)),e.currentPattern.shootPattern[e.patternIndex])):(e.shootCount=0,e.patternIndex+1==e.currentPattern.shootFrequency.length?(e.patternIndex=0,e.repeatCount+1==e.currentPattern.repeat?(e.repeatCount=0,e.targetReached=!1,e.currentPattern==B?e.currentPattern=P:e.currentPattern==P&&(e.currentPattern=B)):(e.repeatCount+=1,e.currentPattern.resetPosOnRepeat&&(e.targetReached=!1))):e.patternIndex+=1)),!(n(e.x)!=e.currentPattern.tx&&d(e.x)!=e.currentPattern.tx||n(e.y)!=e.currentPattern.ty&&d(e.y)!=e.currentPattern.ty))e.targetReached=!0,e.dx=0,e.dy=0}(ye),function(e,n){for(let d of function(e){return e.entities.filter((e=>!e.dead))}(n)){for(let i of e.bullets.bullets)null!=te(d,i)&&(x(i),Q(d,n));for(let i of d.bullets.bullets)null!=te(e,i)&&(D(n),ue(e));null!=te(e,d)&&(ue(e),D(n))}}(he,ce)}!function e(d){window.requestAnimationFrame((n=>e(n)));var i,u,t=0;d>oe+le&&(t=n((d-oe)/le));for(var f=0;f<t;f++)oe+=le,pe();(function({canvas:e}){e.clearRect(0,0,a.width,a.height)})(xe),function(e,n){l(e,n);for(let d of n.bullets.bullets)d.isActive&&y(e,d)}(xe,he),b(i=xe,(u=ye).bullets),l(i,u,u.color),se=d}(0);