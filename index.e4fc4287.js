function e(e){return Math.round(e)}function t(e){return Math.floor(e)}function n(e){return Math.ceil(e)}function i(e,t){return Math.min(e,t)}function a(e){return Math.cos(e)}function l(e){return Math.sin(e)}function r(e,t){return Math.pow(e,t)}function o(e){return document.getElementById(e)}const u=Math.PI,d={debug:!1,width:960,height:640,playerSpeedX:300,playerSpeedY:300,playerWidth:50,playerHeight:50,playerBulletSpeedX:200,playerBulletSpeedY:100,playerBulletsPoolSize:200,playerSprayOpen:3,playerBulletWidth:5,playerBulletHeight:5,enemyWidth:50,enemyHeight:50,enemyBulletSpeedX:150,enemyBulletSpeedY:50,enemyBulletsPoolSize:50,enemyShootFrequency:1,enemyBulletPoolSize:1e3,enemySprayOpen:1,bossWidth:150,bossHeight:150,bossRxMin:100,bossRxMax:200,bossRyMin:100,bossRyMax:200,bossSpeed:300,bossBulletSpeedX:100,bossBulletSpeedY:100,bossBulletsPoolSize:200,bossBigBulletWidth:25,bossBigBulletHeight:25,bossBigBulletExplosionTick:200,bossPatternFrequency:5,bossSprayOpen:2,bossLife:100,bulletWidth:5,bulletHeight:5,bulletMaxHeight:500,bulletsVariance:20,bulletsMaxdY:200,waveEasyCount:3,waveEasyTimeMin:4,waveEasyTimeMax:6,waveEasyAmplitudeMin:10,waveEasyAmplitudeMax:50,waveEasyFrequencyMin:.1,waveEasyFrequencyMax:.25,waveEasyRxMin:100,waveEasyRxMax:200,waveEasyRyMin:100,waveEasyRyMax:200,waveEasySyMin:0,waveEasySyMax:590,waveMediumCount:3,waveMediumTimeMin:4,waveMediumTimeMax:6,waveMediumAmplitudeMin:10,waveMediumAmplitudeMax:50,waveMediumFrequencyMin:.1,waveMediumFrequencyMax:.25,waveMediumRxMin:100,waveMediumRxMax:200,waveMediumRyMin:100,waveMediumRyMax:200,waveMediumSyMin:0,waveMediumSyMax:590,waveHardCount:3,waveHardTimeMin:4,waveHardTimeMax:6,waveHardAmplitudeMin:10,waveHardAmplitudeMax:50,waveHardFrequencyMin:.1,waveHardFrequencyMax:.25,waveHardRxMin:100,waveHardRxMax:200,waveHardRyMin:100,waveHardRyMax:200,waveHardSyMin:0,waveHardSyMax:590,powerUpMaxCount:5,engineTimeResolution:1,epsilon:.1,delta:.001};function s(e,t,n=null){const i=null==n?(a="canvas",document.createElement(a)):o(n);var a;i.width=e,i.height=t;return i.getContext("2d")}function h({canvas:t},{x:n,y:i,w:a,h:l},r="#FF0000"){t&&(t.fillStyle=r),t.fillRect(e(n),e(i),a,l)}function y(e,t){return{x:e,y:t}}function c(e,t){return y(e.x+t.x,e.y+t.y)}function p(e=d.bulletHeight,t=d.bulletWidth,n=!1){return{x:0,y:0,w:t,h:e,dx:0,dy:0,isActive:!1,dh:0,dhDirection:0,explodeTick:0,bullets:void 0,shielded:n}}function f(e){if(!e.isActive)return;e.x+=e.dx*d.delta;const n=e.h;if(e.h=i(e.h+e.dh,d.bulletMaxHeight),e.h==d.bulletMaxHeight&&(e.dy=-30*l(e.x/d.width*6*u)),e.y+=e.dy*d.delta-(e.h-n)*e.dhDirection,0!=e.explodeTick&&(e.explodeTick-=1,0==e.explodeTick)){if(null==e.bullets)return void M(e);const n=e.dx/2;for(let i=0;i<4;i++){let a=e.bullets.bullets.find((e=>!e.isActive));if(null==a)return void M(e);m(e.bullets,a,e,y(r(-1,i)*n,r(-1,t(i/2))*n+e.dy))}M(e)}(e.x<0||e.x>d.width)&&M(e),e.h==d.bulletHeight&&(e.y+e.h/2<0||e.y>d.height+e.h/2)&&M(e)}function x(e,t){t.isActive&&h(e,t)}function m(e,t,n,i){t.x=n.x,t.y=n.y,t.dx=i.x,t.dy=i.y,t.isActive=!0,t.bullets=e}function M(e){e.isActive=!1,e.dx=0,e.dy=0,e.x=0,e.y=0,e.h=e.bullets?.bh??0,e.w=e.bullets?.bw??0,e.dh=0,e.shielded=e.bullets?.shielded}function w(e,t){const n=[];for(let i=0;i<t;i++)n.push(e());return n}function b(...e){return e[Math.floor(Math.random()*e.length)]}function g(e,t){return Math.random()*(t-e)+e}function v(e,t){return e=Math.ceil(e),t=Math.floor(t)+1,Math.floor(Math.random()*(t-e)+e)}function S(){return Math.floor(16777215*Math.random()).toString(16)}let H;var T;function P(e,t,n,i,a,l,r=!1){return{bullets:w((()=>p(a,l,r)),e),baseSpeedX:t,baseSpeedY:n,lastRandY:0,sprayOpen:i,shielded:r,bh:a,bw:l}}function R(e,t){let n=g(-t,t),a=e.lastRandY+n;var l,r;return l=i(d.bulletsMaxdY,a),r=-d.bulletsMaxdY,a=Math.max(l,r),e.lastRandY=a,a}function E(e,t,n,i,l=0){let r=R(e,l);if(i<H.ConicEnd)for(let o=0;o<=i;o++){let d=e.bullets.find((e=>!e.isActive));if(null==d)return;m(e,d,n,y(t,e.baseSpeedY*a(u*((o+1)/(i+2)))*e.sprayOpen+r)),r=R(e,l)}if(i==H.Straight){let i=e.bullets.find((e=>!e.isActive));if(null==i)return;i.dh=.1,m(e,i,n,y(t,r))}if(i==H.StraightHole){let i=e.bullets.find((e=>!e.isActive));if(null==i)return;if(i.dh=.4,i.dhDirection=0,m(e,i,n,y(t,r+150*i.dh+10)),i=e.bullets.find((e=>!e.isActive)),null==i)return;i.dh=.4,i.dhDirection=1,m(e,i,n,y(t,r-(150*i.dh+10)))}if(i==H.Explosion){let i=e.bullets.find((e=>!e.isActive));if(null==i)return;i.w=d.bossBigBulletWidth,i.h=d.bossBigBulletHeight,i.bullets=e,i.explodeTick=d.bossBigBulletExplosionTick,m(e,i,c(n,y(d.bossBigBulletWidth,-d.bossBigBulletHeight/2)),y(t,r))}if(i==H.UpAndDown){for(let o=0;o<=10;o++){let s=e.bullets.find((e=>!e.isActive));if(null==s)return;m(e,s,c(n,y(d.bossWidth/2,d.bossHeight/2)),y(t*a(u*((o+1)/(i+2)))*.5+r,e.baseSpeedY)),r=R(e,l)}for(let o=0;o<=10;o++){let s=e.bullets.find((e=>!e.isActive));if(null==s)return;m(e,s,c(n,y(d.bossWidth/2,-d.bossHeight/2)),y(t*a(u*((o+1)/(i+2)))*.5+r,-e.baseSpeedY)),r=R(e,l)}}}function C(e){for(let t of A(e))f(t)}function B(e,t){for(let n of A(t))x(e,n)}function A(e){return e.bullets.filter((e=>e.isActive))}function W(e){for(let t of e.bullets)M(t)}(T=H||(H={}))[T.Single=0]="Single",T[T.Double=1]="Double",T[T.Triple=2]="Triple",T[T.Quadruple=3]="Quadruple",T[T.Quintuple=4]="Quintuple",T[T.Sixtuple=5]="Sixtuple",T[T.ConicEnd=6]="ConicEnd",T[T.Straight=7]="Straight",T[T.StraightHole=8]="StraightHole",T[T.Explosion=9]="Explosion",T[T.UpAndDown=10]="UpAndDown";const q={waitTime:2,tx:.8*d.width-d.bossWidth,ty:.5*d.height-d.bossHeight/2,dx:5,dy:15,shootPattern:[H.Sixtuple,H.Quintuple,H.Triple,H.UpAndDown],shootCount:[4,3,5,5],shootFrequency:[4,3,2,5],shootSpeed:[200,120,250,50],shootRandom:[150,300,300,150],repeat:3,resetPosOnRepeat:!0},F={waitTime:3,tx:d.width-d.bossWidth,ty:.2*d.height,dx:0,dy:60,shootPattern:[H.UpAndDown,H.StraightHole],shootCount:[5,40],shootFrequency:[5,3],shootSpeed:[200,100],repeat:1,shootRandom:[0,20],resetPosOnRepeat:!0},Y={waitTime:0,tx:d.width-d.bossWidth,ty:.5*d.height-d.bossHeight,dx:-50,dy:0,shootPattern:[H.Explosion,H.Double],shootCount:[10,5],shootFrequency:[3,5],shootSpeed:[500,600],repeat:2,shootRandom:[600,100],resetPosOnRepeat:!0};function D(){const e=`#${S()}`;return{x:.5*d.width-d.bossWidth/2,y:.5*d.height-d.bossHeight/2,w:d.bossWidth,h:d.bossHeight,dx:0,dy:0,color:e,bullets:P(d.bossBulletsPoolSize,d.bossBulletSpeedX,d.bossBulletSpeedY,d.bossSprayOpen,d.bulletWidth,d.bulletHeight),elapsedTime:0,currentPattern:F,shootElapsedTime:0,newPatternTime:0,shootCount:0,targetReached:!1,patternIndex:0,repeatCount:0,life:d.bossLife}}function I(e){C(e.bullets),e.elapsedTime+=d.delta,e.shootElapsedTime+=d.delta;const i=d.bossSpeed;if(0!=e.newPatternTime){if(!(e.elapsedTime>=e.newPatternTime))return;e.newPatternTime=0,e.currentPattern==q?e.currentPattern=F:e.currentPattern==F?e.currentPattern=Y:e.currentPattern==Y&&(e.currentPattern=q)}if(e.targetReached?(e.y>.9*d.height-d.bossHeight||e.y<.1*d.height)&&(e.dy*=-1):(e.x>e.currentPattern.tx?e.dx=-i:e.x<e.currentPattern.tx&&(e.dx=i),e.y>e.currentPattern.ty?e.dy=-i:e.y<e.currentPattern.ty&&(e.dy=i)),e.x+=e.dx*d.delta,e.y+=e.dy*d.delta,e.targetReached)if(e.shootCount<e.currentPattern.shootCount[e.patternIndex])e.shootElapsedTime>=1/e.currentPattern.shootFrequency[e.patternIndex]&&(e.shootCount+=1,e.shootElapsedTime=0,null!=e.currentPattern.shootPattern[e.patternIndex]&&E(e.bullets,e.dx-e.currentPattern.shootSpeed[e.patternIndex],c(e,y(0,d.bossHeight/2)),e.currentPattern.shootPattern[e.patternIndex],e.currentPattern.shootRandom[e.patternIndex]));else if(e.shootCount=0,e.bullets.lastRandY=0,e.patternIndex+1==e.currentPattern.shootFrequency.length){if(e.patternIndex=0,e.repeatCount+1==e.currentPattern.repeat)return e.repeatCount=0,e.targetReached=!1,void(e.newPatternTime=e.elapsedTime+e.currentPattern.waitTime);e.repeatCount+=1,e.currentPattern.resetPosOnRepeat&&(e.targetReached=!1)}else e.patternIndex+=1;else if(!(t(e.x)!=e.currentPattern.tx&&n(e.x)!=e.currentPattern.tx||t(e.y)!=e.currentPattern.ty&&n(e.y)!=e.currentPattern.ty))return e.targetReached=!0,e.dx=e.currentPattern.dx,void(e.dy=e.currentPattern.dy)}function U(e,t){B(e,t.bullets),h(e,t,t.color)}function O(e){e.x=.5*d.width-d.bossWidth/2,e.y=.5*d.height-d.bossHeight/2,e.dx=0,e.dy=0,W(e.bullets),e.elapsedTime=0,e.currentPattern=F,e.shootElapsedTime=0,e.newPatternTime=0,e.shootCount=0,e.targetReached=!1,e.patternIndex=0,e.repeatCount=0}let X;var k;let L;function Q(e,t,n,i,a,l,r,o,u=H.Single){return{x:d.width,y:e,sy:e,dx:0,dy:0,w:d.enemyWidth,h:d.enemyHeight,pattern:t,time:i,color:n,dead:!1,amplitude:a,frequency:l,rx:r,ry:o,elapsedTime:0,shootElapsedTime:0,distance:0,direction:X.Left,bullets:P(d.enemyBulletsPoolSize,d.enemyBulletSpeedX,d.enemyBulletSpeedY,d.enemySprayOpen,d.bulletWidth,d.bulletHeight),bulletsPattern:u}}function z(e){if(C(e.bullets),e.dead)return;const t=e.frequency,n=e.amplitude,i=(d.width+d.enemyWidth)/e.time;e.elapsedTime+=d.delta,e.shootElapsedTime+=d.delta,e.pattern==L.Circular&&(e.dx=2*u*t*n*a(2*u*t*e.elapsedTime)-i,e.dy=2*u*t*n*l(2*u*t*e.elapsedTime)),e.pattern==L.Rectangular&&(null==e.direction&&(e.direction=X.Left),e.direction==X.Left&&(e.distance>=e.rx&&(e.direction=b(X.Up,X.Down),e.distance=0),e.dx=-i,e.dy=0,e.distance+=-e.dx*d.delta),e.direction,X.Right,e.direction==X.Up&&(e.distance>=e.ry&&(e.direction=X.Left,e.distance=0),e.dy=-i/2,e.dx=0,e.distance+=-e.dy*d.delta),e.direction==X.Down&&(e.distance>=e.ry&&(e.direction=X.Left,e.distance=0),e.dy=i/2,e.dx=0,e.distance+=e.dy*d.delta)),e.pattern==L.Triangular&&(e.y>=e.sy+n&&(e.dy=-4*n*t),(0==e.dy||e.y<=e.sy-n)&&(e.dy=4*n*t),e.dx=-i),e.pattern==L.Straight&&(e.dx=-i),e.x+=e.dx*d.delta,e.y+=e.dy*d.delta,e.shootElapsedTime>=1/d.enemyShootFrequency&&(e.shootElapsedTime=0,E(e.bullets,-i-d.enemyBulletSpeedX,c(e,y(0,d.enemyHeight/2)),e.bulletsPattern))}function G(e,t){B(e,t.bullets),t.dead||h(e,t,t.color)}(k=X||(X={}))[k.Up=0]="Up",k[k.Left=1]="Left",k[k.Right=2]="Right",k[k.Down=3]="Down",function(e){e[e.Straight=0]="Straight",e[e.Triangular=1]="Triangular",e[e.Circular=2]="Circular",e[e.Rectangular=3]="Rectangular"}(L||(L={}));const $={up:!1,down:!1,left:!1,right:!1,space:!1,shift:!1,m:!1};function V(e){let t=!0;return()=>$[e]&&t?(t=!1,!0):($[e]||(t=!0),!1)}onkeydown=onkeyup=e=>function(e,t){38!=e&&90!=e&&87!=e||($.up=t);39!=e&&68!=e||($.right=t);40!=e&&83!=e||($.down=t);37!=e&&65!=e&&81!=e||($.left=t);16==e&&($.shift=t);32==e&&($.space=t);77==e&&($.m=t)}(e.keyCode,null!=e.type[5]);let j,J,K,N,Z,_=null,ee=(...e)=>{let t=_.createBufferSource(),n=_.createBuffer(e.length,e[0].length,ie);return e.map(((e,t)=>n.getChannelData(t).set(e))),t.buffer=n,t.connect(_.destination),t.start(),t},te=(e=1,t=.05,n=220,i=0,a=0,l=.1,r=0,o=1,u=0,d=0,s=0,h=0,y=0,c=0,p=0,f=0,x=0,m=1,M=0,w=0)=>{let b,g,v=2*Math.PI,S=u*=500*v/ie**2,H=(0<p?1:-1)*v/4,T=n*=(1+2*t*Math.random()-t)*v/ie,P=[],R=0,E=0,C=0,B=1,A=0,W=0,q=0;for(d*=500*v/ie**3,p*=v/ie,s*=v/ie,h*=ie,y=ie*y|0,g=(i=99+ie*i)+(M*=ie)+(a*=ie)+(l*=ie)+(x*=ie)|0;C<g;P[C++]=q)++W%(100*f|0)||(q=r?1<r?2<r?3<r?Math.sin((R%v)**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/v%2+2)%2:1-4*Math.abs(Math.round(R/v)-R/v):Math.sin(R),q=(y?1-w+w*Math.sin(2*Math.PI*C/y):1)*(0<q?1:-1)*Math.abs(q)**o*e*ne*(C<i?C/i:C<i+M?1-(C-i)/M*(1-m):C<i+M+a?m:C<g-x?(g-C-x)/l*m:0),q=x?q/2+(x>C?0:(C<g-x?1:(g-C)/x)*P[C-x|0]/2):q),b=(n+=u+=d)*Math.sin(E*p-H),R+=b-b*c*(1-1e9*(Math.sin(C)+1)%2),E+=b-b*c*(1-1e9*(Math.sin(C)**2+1)%2),B&&++B>h&&(n+=s,T+=s,B=0),!y||++A%y||(n=T,u=S,B=B||1);return P},ne=.3,ie=44100,ae=(e,t,n,i=125)=>{let a,l,r,o,u,d,s,h,y,c,p,f,x,m,M,w=0,b=[],g=[],v=[],S=0,H=0,T=1,P={},R=ie/i*60>>2;for(;T;S++)b=[T=h=p=x=0],n.map(((i,p)=>{for(s=t[i][S]||[0,0,0],T|=!!t[i][S],M=x+(t[i][0].length-2-!h)*R,m=p==n.length-1,l=2,o=x;l<s.length+m;h=++l){for(u=s[l],y=l==s.length+m-1&&m||c!=(s[0]||0)|u|0,r=0;r<R&&h;r++>R-99&&y&&(f+=(f<1)/99))d=(1-f)*b[w++]/2||0,g[o]=(g[o]||0)-d*H+d,v[o]=(v[o++]||0)+d*H+d;u&&(f=u%1,H=s[1]||0,(u|=0)&&(b=P[[c=s[w=0]||0,u]]=P[[c,u]]||(a=[...e[c]],a[2]*=2**((u-12)/12),u>0?te(...a):[])))}x=M}));return[g,v]},le=[[[,0,261,,,2,2,,,,,,,,,,.01],[,0,32,.05,,.2,3,5],[3,0,43,,,.25,,,,,,,,2],[1.6,0,655,,,,3,1.65,,,,,.02,3.8,-.1,,.2],[,0,232,.01,.09,.15,2,,,,,,154.87,,,,.26]],[[[,,4,,,,,,3,,,,,,,,,,,,,,,,,,,,,,,,,,4,,,,,,3,,,,,,,,,,,,,,,,,,,,,,3,,,,],[,,10,,,,,,10,,,,,,,,,,,,,,,,,,,,,,,,,,10,,,,,,10,,,,,,,,,,,,,,,,,,,,,,,,,,],[,,16,,,,,,15,,,,,,,,,,,,,,,,,,,,,,,,,,16,,,,,,15,,,,,,,,,,,,,,,,,,,,,,,,,,],[1,,,,,,,,,,,,,,,,,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,]],[[,,4,,,,,,3,,,,,,,,,,3,,3,,3,,3,,3,,3,,3,,,,4,,,,,,3,,,,,,,,,,4,,3,,3,,3,,3,,3,,3,,,,],[,,10,,,,,,10,,,,,,,,,,,,,,,,,,,,,,,,,,10,,,,,,10,,,,,,,,,,,,,,,,,,,,,,,,,,],[,,16,,,,,,15,,,,,,,,,,,,,,,,,,,,,,,,,,16,,,,,,15,,,,,,,,,,,,,,,,,,,,,,,,,,],[1,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,]],[[,,4,,,,,,3,,,,,,,,,,3,,3,,3,,3,,3,,3,,3,,,,4,,,,,,3,,,,,,,,,,4,,3,,3,,3,,3,,3,,3,,,,],[,,10,,,,,,10,,,,,,,,,,,,,,,,,,,,,,,,,,10,,,,,,10,,,,,,,,,,,,,,,,,,,,,,,,,,],[,,16,,,,,,15,,,,,,,,,,,,,,,,,,,,,,,,,,16,,,,,,15,,,,,,,,,,,,,,,,,,,,,,,,,,],[1,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,],[2,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,],[3,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,]],[[,,4,,,,,,3,,,,,,,,,,3,,3,,3,,3,,3,,3,,3,,,,4,,,,,,3,,,,,,,,,,4,,3,,3,,3,,3,,3,,3,,,,],[4,,,,,,,,,,,,,,25,24,25,24,,,,,25,24,25,24,,,,,,,,,,,,,,,,,,,,,25,24,25,24,,,,,25,24,25,24,22,,,,,,,,],[,,16,,,,,,15,,,,,,,,,,,,,,,,,,,,,,,,,,16,,,,,,15,,,,,,,,,,,,,,,,,,,,,,,,,,],[1,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,],[2,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,],[3,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,]],[[,,4,,,,,,3,,,,,,,,,,3,,3,,3,,3,,3,,3,,3,,,,4,,,,,,3,,,,,,,,,,4,,3,,3,,3,,3,,3,,3,,,,],[4,,,,,,,,,,,,,,25,24,25,24,,,,,25,24,25,24,,,,,,,,,,,,,,,,,,,,,25,24,25,24,,,,,25,24,25,24,22,,,,,,,,],[,,16,,,,,,15,,,,,,,,,,,,,,,,,,,,,,,,,,16,,,,,,15,,,,,,,,,,,,,,,,,,,,,,,,,,],[1,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,],[4,,,,,,,,,,,,,,30,29,30,29,,,,,18,17,18,17,,,,,,,,,,,,,,,,,,,,,30,29,30,29,,,,,18,17,18,17,15,,,,,,,,],[3,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,13]],[[,,4,,,,,,3,,,,,,,,,,3,,3,,3,,3,,3,,3,,3,,,,4,,,,,,3,,,,,,,,,,4,,3,,3,,3,,3,,3,,3,,,,],[4,,,,,,,,,,,,,,25,24,25,24,,,,,25,24,25,24,,,,,,,,,,,,,,,,,,,,,25,24,25,24,,,,,25,24,25,24,22,,,,,,,,],[4,,13,13,13,13,13,13,12,12,12,12,12,12,12,,,,12,12,12,12,,,,,12,12,12,12,12,12,12,12,13,13,13,13,13,13,10,10,10,10,10,10,,,,,10,10,10,10,,,,,,10,10,10,10,10,10,10],[1,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,3,,],[4,,,,,,,,,,,,,,30,29,30,29,,,,,18,17,18,17,,,,,,,,,,,,,,,,,,,,,30,29,30,29,,,,,18,17,18,17,15,,,,,,,,],[3,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,13]]],[0,1,1,2,2,3,3,4,4,5,5,3,3,4,4,5,5,2,2],135,undefined],re=[[[.5,0,128,,.08,.5,3],[.8,0,32,,.07,.11,2,0,,,.5,.01],[2,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[.9,0,32,,,.35,3,2]],[[[1,,13,13,15,13,13,13,15,16,13,13,15,13,13,13,16,15,13,13,15,13,13,13,15,16,13,13,15,13,13,13,16,21],[,,15,,20,15,,18,,,,,,,21,16,15,,15,,20,15,,20,,,,,,,23,18,15,,],[2,,,,,,,,,,13,13,13,13,,,,,,,,,,,,,1,1,1,1,,,,,]],[[1,,13,13,15,13,13,13,15,16,13,13,15,13,13,13,16,15,13,13,15,13,13,13,15,16,13,13,15,13,13,13,16,21],[,,15,,20,15,,18,,,,,,,21,16,15,,15,,20,15,,20,,,,,,,23,18,15,,],[2,,,,,,,,,,13,13,13,13,,,,,,,,,,,,,1,1,1,1,,,,,],[3,,20,,,,20,,,,20,,,,20,,15,,13,,,,13,,,,13,,,,13,,16,,]],[[1,,13,13,15,13,13,13,15,16,13,13,15,13,13,13,16,15,13,13,15,13,13,13,15,16,13,13,15,13,13,13,16,21]]],[2,2,0,0,1,0,1,0,1,0],80],oe=[[[1.5,0,130,,,.5,,,,,,,,,,,,.15,.6],[,0,130,.01,.09,.15,2,,,,,,154.87,,,,.26],[1.4,0,32,,,.25,3,5]],[[[,,24,,,,20,,,,17,,,,13,,,,10,,,,10,,,,10,,,,10,,,,13,,,,17,,,,20,,,,24,,,,10,,,,10,,,,10,,,,13,,,,],[1,,24,20,22,18,20,17,18,15,17,13,15,12,13,10,12,8,10,10,,,10,10,,,10,10,,,10,,10,,24,20,22,18,20,17,18,15,17,13,15,12,13,10,12,8,10,10,,,10,10,,,10,10,,,10,,13,,],[,,36,32,34,,,,,,29,25,27,,,,,,22,,,,22,,,,,,,,,,,,22,25,24,,,,,,29,32,30,,,,,,25,,,,25,,,,25,,,,25,,,,],[2,,12,,12,,12,,12,,12,,12,,12,,12,,10,,10,,10,,10,,10,,10,,10,,10,,12,,12,,12,,12,,12,,12,,12,,12,,10,,10,,10,,10,,10,,10,,10,,5,,]],[[,,24,,,,20,,,,17,,,,13,,,,10,,,,10,,,,10,,,,10,,,,13,,,,17,,,,20,,,,24,,,,10,,,,10,,,,10,,,,13,,,,],[1,,24,20,22,18,20,17,18,15,17,13,15,12,13,10,12,8,10,10,,,10,10,,,10,10,,,10,,10,,24,20,22,18,20,17,18,15,17,13,15,12,13,10,12,8,10,10,,,10,10,,,10,10,,,10,,13,,],[,,36,32,34,,,,,,29,25,27,,,,,,22,,,,22,,,,,,,,,,,,22,25,24,,,,,,29,32,30,,,,,,25,,,,25,,,,25,,,,25,,,,]],[[,,24,,,,20,,,,17,,,,13,,,,10,,,,10,,,,10,,,,10,,,,13,,,,17,,,,20,,,,24,,,,10,,,,10,,,,10,,,,13,,,,],[,,36,32,34,,,,,,29,25,27,,,,,,22,,,,22,,,,,,,,,,,,22,25,24,,,,,,29,32,30,,,,,,25,,,,25,,,,25,,,,25,,,,]],[[,,24,,,,20,,,,17,,,,13,,,,10,,,,10,,,,10,,,,10,,,,13,,,,17,,,,20,,,,24,,,,10,,,,10,,,,10,,,,13,,,,],[1,,24,20,22,18,20,17,18,15,17,13,15,12,13,10,12,8,10,10,,,10,10,,,10,10,,,10,,10,,24,20,22,18,20,17,18,15,17,13,15,12,13,10,12,8,10,10,,,10,10,,,10,10,,,10,,13,,]]],[2,3,3,1,1,0,0,0,0,0,0],120],ue=[[[1.5,0,32,.05,.25,,3,3,,,,,,,,,3,.6],[,0,128,,,.2,2,,,,,,,,,.02,.01],[,0,1024,,,.3,2,.2,-.1,-.15,9,.02,,.1,.12,,.06]],[[[,,13,,13,,,,,,6,,6,,,,,,8,,8,,,,,,3,,3,,,,,,],[1,,25,,25,,25,,25,,18,,18,,18,,18,,12,,12,,12,,12,,3,,3,,3,,3,,],[1,,22,,22,,22,,22,,15,,15,,15,,15,,8,,8,,8,,8,,6,,6,,6,,6,,],[2,,25,22,,,,,,,15,18,,15,,,,,12,,,,,,,,6,,6,6,,3,,,]],[[,,13,,13,,,,,,6,,6,,,,,,8,,8,,,,,,3,,3,,,,,,],[1,,25,,25,,25,,25,,18,,18,,18,,18,,12,,12,,12,,12,,3,,3,,3,,3,,],[1,,22,,22,,22,,22,,15,,15,,15,,15,,8,,8,,8,,8,,6,,6,,6,,6,,],[2,,25,22,,,,,,,15,15,,18,,,,,8,8,,12,,,,,6,,6,6,,3,,,]],[[,,13,,13,,,,,,6,,6,,,,,,8,,8,,,,,,3,,3,,,,,,],[1,,25,,,,,,,,18,,,,18,,,,12,,,,,,,,3,,,,3,,,,],[1,,22,,,,22,,,,15,,,,,,,,8,,,,8,,,,6,,,,,,,,]]],[2,2,0,1,0,1],120];var de;(de=Z||(Z={}))[de.Speed=0]="Speed",de[de.Shield=1]="Shield",de[de.Multishot=2]="Multishot";let se=0,he=0,ye=0,ce=null;function pe(e){o("ui-shop").style.display=e?"flex":"none"}function fe(e){o("current-money").innerText=e.toString()}window.onPowerUpChanged=function(e,t){const n=ce.player;He(n,-t)&&(e==Z.Speed&&(se+=t),e==Z.Shield&&(he+=t),e==Z.Multishot&&(ye+=t),se<0&&(se=0,He(n,t)),he<0&&(he=0,He(n,t)),ye<0&&(ye=0,He(n,t)),o("current-speed").innerText=se.toString(),o("current-shield").innerText=he.toString(),o("current-multishot").innerText=ye.toString())},window.play=function(){Ge(Ee.Game,ce)};const xe=V("space"),me=V("shift");let Me,we=!1,be=!1;function ge(e){let t=0,n=0;C(e.bullets),$.left&&(t+=-d.playerSpeedX),$.right&&(t+=d.playerSpeedX),$.up&&(n+=-d.playerSpeedY),$.down&&(n+=d.playerSpeedY),xe()&&function(e){null!=e.bullets.bullets.find((e=>!e.isActive))&&E(e.bullets,e.shootSpeed*d.playerBulletSpeedX,c(e,y(d.playerWidth,d.playerHeight/2)),e.bulletsPattern)}(e),e.dx=t,e.dy=n,be||(_=new window.AudioContext,J=ae(...oe),j=[ae(...le),ae(...re)],K=ae(...ue),be=!0),be&&me()&&(we?N.stop():(_?.resume(),N=ee(...j[v(0,1)]),N.loop=!0),we=!we),e.x+=e.dx*d.delta,e.y+=e.dy*d.delta,e.x<=0&&(e.x=0),e.x>=d.width-d.playerWidth&&(e.x=d.width-d.playerWidth),e.y<=0&&(e.y=0),e.y>=d.height-d.playerHeight&&(e.y=d.height-d.playerHeight)}function ve(e){e.x=d.playerWidth,e.y=d.height/2,e.dx=0,e.dy=0;let t=[se,he,ye];e.shootSpeed=t[Z.Speed]+1,e.shieldCount=t[Z.Shield]+1,e.shieldCount=5,e.shieldCount==d.powerUpMaxCount&&(e.bullets.shielded=!0),t[Z.Multishot]==d.powerUpMaxCount?e.bulletsPattern=H.Straight:e.bulletsPattern=t[Z.Multishot]}function Se(e){return e.shieldCount-=1,e.shieldCount}function He(e,t){return!(e.money+t<0)&&(e.money+=t,fe(e.money),!0)}var Te;function Pe(e){const t=[];if(e==Me.Easy){const n=v(3,6);for(let i=0;i<n;i++)t.push(Re(e))}if(e==Me.Medium){const n=v(5,10);for(let i=0;i<n;i++)t.push(Re(e))}if(e==Me.Hard){const n=v(9,17);for(let i=0;i<n;i++)t.push(Re(e))}return{difficulty:e,enemies:t}}function Re(e){const t=`#${S()}`;if(e==Me.Easy){const e=b(L.Straight,L.Triangular),n=g(d.waveEasyAmplitudeMin,d.waveEasyAmplitudeMax),i=g(d.waveEasyFrequencyMin,d.waveEasyFrequencyMax),a=g(d.waveEasyRxMin,d.waveEasyRxMax),l=g(d.waveEasyRyMin,d.waveEasyRyMax);return Q(g(d.waveEasySyMin,d.waveEasySyMax),e,t,g(d.waveEasyTimeMin,d.waveEasyTimeMax),n,i,a,l,v(H.Single,H.Double))}if(e==Me.Medium){const e=b(L.Straight,L.Triangular,L.Rectangular),n=g(d.waveMediumAmplitudeMin,d.waveMediumAmplitudeMax),i=g(d.waveMediumFrequencyMin,d.waveMediumFrequencyMax),a=g(d.waveMediumRxMin,d.waveMediumRxMax),l=g(d.waveMediumRyMin,d.waveMediumRyMax);return Q(g(d.waveMediumSyMin,d.waveMediumSyMax),e,t,g(d.waveMediumTimeMin,d.waveMediumTimeMax),n,i,a,l,v(H.Single,H.Quintuple))}if(e==Me.Hard){const e=b(L.Triangular,L.Rectangular,L.Circular),n=g(d.waveHardAmplitudeMin,d.waveHardAmplitudeMax),i=g(d.waveHardFrequencyMin,d.waveHardFrequencyMax),a=g(d.waveHardRxMin,d.waveHardRxMax),l=g(d.waveHardRyMin,d.waveHardRyMax);return Q(g(d.waveHardSyMin,d.waveHardSyMax),e,t,g(d.waveHardTimeMin,d.waveHardTimeMax),n,i,a,l,v(H.Double,H.Sixtuple))}throw new Error}(Te=Me||(Me={}))[Te.Easy=0]="Easy",Te[Te.Medium=1]="Medium",Te[Te.Hard=2]="Hard";let Ee,Ce=0,Be=1,Ae=d.waveEasyCount+d.waveMediumCount+d.waveHardCount+1,We=V("m");function qe(e){if(Ce+=d.delta,(Ce>=d.waveEasyTimeMax||e.deadCount==e.entities.length)&&(De(e),Ce=0),Be<Ae)for(let t of e.entities)z(t);else I(e.boss);We()&&De(e)}function Fe(e,t){if(Be<Ae)for(let n of t.entities)G(e,n);else U(e,t.boss)}function Ye(e){return e.entities.filter((e=>!e.dead))}function De(e){Be++;let t=Me.Easy;Be>3&&Be<=6&&(t=Me.Medium),Be>6&&(t=Me.Hard),e.entities=Pe(t).enemies,e.deadCount=0,Ce=0,He(e.player,1)}function Ie(e,t){e.dead=!0,t.deadCount++}function Ue(e,t){const n=ke(Oe(e),Oe(t)),i=ke(Xe(e),Xe(t));return null==n||null==i?null:{x:n.x,y:i.x,w:n.y-n.x,h:i.y-i.x}}function Oe(e){return{x:e.x,y:e.x+e.w}}function Xe(e){return{x:e.y,y:e.y+e.h}}function ke(e,t){return e.y<=t.x||t.y<=e.x?null:{x:Math.max(e.x,t.x),y:Math.min(e.y,t.y)}}var Le;function Qe(e){e.scene==Ee.Game&&(ge(e.player),qe(e.enemies),function(e){const t=e.enemies,n=e.player;for(let i of Ye(t)){for(let e of A(n.bullets))null!=Ue(i,e)&&(M(e),Ie(i,t));for(let t of A(i.bullets))null!=Ue(n,t)&&0==Se(n)&&Ge(Ee.Shop,e);null!=Ue(n,i)&&Ge(Ee.Shop,e)}for(let i of A(t.boss.bullets))null!=Ue(n,i)&&0==Se(n)&&Ge(Ee.Shop,e);for(let e of A(n.bullets))null!=Ue(t.boss,e)&&(M(e),t.boss.life--)}(e))}function ze(e,t){t.scene==Ee.Game&&(!function(e,t){h(e,t);for(let n of t.bullets.bullets)n.isActive&&x(e,n)}(e,t.player),Fe(e,t.enemies))}function Ge(e,t){var n;ve(t.player),n=t.enemies,Be=1,De(n),O(t.enemies.boss),t.scene=e,e==Ee.Shop&&pe(!0),e==Ee.Game&&pe(!1)}(Le=Ee||(Ee={}))[Le.Shop=0]="Shop",Le[Le.Game=1]="Game",Le[Le.Quest=2]="Quest";let $e=d.engineTimeResolution,Ve=performance.now(),je=Ve;const Je={canvas:s(d.width,d.height,"gameCanvas")},Ke=function(){const e=function(){const e={x:d.playerWidth,dx:0,y:d.height/2,dy:0,w:d.playerWidth,h:d.playerHeight,bullets:P(d.playerBulletsPoolSize,d.playerBulletSpeedX,d.playerBulletSpeedY,d.playerSprayOpen,d.playerBulletWidth,d.playerBulletHeight),bulletsPattern:H.Single,shootSpeed:1,shieldCount:0,money:10};return fe(e.money),e}(),t=function(e){return{entities:Pe(Me.Easy).enemies,deadCount:0,boss:D(),player:e}}(e),n={player:e,enemies:t,scene:Ee.Shop};return ce=n,n}();!function e(n){window.requestAnimationFrame((t=>e(t)));var i=0;n>Ve+$e&&(i=t((n-Ve)/$e));for(var a=0;a<i;a++)Ve+=$e,Qe(Ke);(function({canvas:e}){e.clearRect(0,0,d.width,d.height)})(Je),ze(Je,Ke),je=n}(0);